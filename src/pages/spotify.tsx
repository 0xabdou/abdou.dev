import Head from "next/head";
import SpotifyCurrentlyPlaying from "../components/spotify-currently-playing";
import SocialSharePreview from "../components/social-share-preview";
import {getLiked, isSpotifyError, Track} from "../lib/spotify";
import {GetStaticProps} from "next";
import TitleWithDescription from "../components/title-with-description";
import SpotifyPlaylist from "../components/spotify-playlist";

type SpotifyPageProps = {
  liked: Track[]
}

const SpotifyPage = (props: SpotifyPageProps) => {
  const title = "Abdou Ouahib | Spotify";
  const description = "Welcome to my lounge, here you can find the current track" +
    " I'm listening to, and also various playlists, either generated by me, or " +
    "by Spotify algorithms, enjoy!";
  return (
    <div className="relative flex flex-col w-full max-w-screen-md mb-10">
      <Head>
        <title>{title}</title>
        <meta name="description" content={description}/>
      </Head>
      <SocialSharePreview
        image="/static/images/social-share-preview/spotify.png"
        title={title}
        description={description}
      />
      <TitleWithDescription title="Spotify" description={description}/>
      <SpotifyCurrentlyPlaying/>
      <SpotifyPlaylist name="Liked Songs" tracks={props.liked}/>
    </div>
  );
};


export const getStaticProps: GetStaticProps<SpotifyPageProps> = async () => {
  const liked = await getLiked();
  if (isSpotifyError(liked)) throw new Error(liked.error);
  return {
    props: {liked},
    revalidate: 86400, // 24 hours
  };
};

export default SpotifyPage;