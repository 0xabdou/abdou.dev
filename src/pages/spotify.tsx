import Head from "next/head";
import TitleWithDescription from "../components/title-with-description";
import SpotifyCurrentlyPlaying from "../components/spotify-currently-playing";
import SocialSharePreview from "../components/social-share-preview";
import {getLiked, isSpotifyError, Track} from "../lib/spotify";
import {GetStaticProps} from "next";

type SpotifyPageProps = {
  liked: Track[]
}

const SpotifyPage = (props: SpotifyPageProps) => {
  const title = "Abdou Ouahib | Spotify";
  const description = "Welcome to my lounge, here you can find the current track" +
    " I'm listening to, and also various playlists, either generated by me, or " +
    "by Spotify algorithms, enjoy!";
  return (
    <div className="flex flex-col max-w-screen-md">
      <Head>
        <title>{title}</title>
        <meta name="description" content={description}/>
      </Head>
      <SocialSharePreview
        image="/static/images/social-share-preview/spotify.png"
        title={title}
        description={description}
      />
      <TitleWithDescription title="Spotify" description={description}/>
      <SpotifyCurrentlyPlaying/>
      <div className="flex flex-col">
        {props.liked.map(track => (
          <div className="flex">
            <img
              src={track.imageURL}
              alt="Track cover"
              width={64}
              height={64}
            />
            <div className="flex flex-col">
              <div>{track.title}</div>
              <div>By {track.artists[0].name}</div>
            </div>
          </div>
        ))}
      </div>

    </div>
  );
};

export const getStaticProps: GetStaticProps<SpotifyPageProps> = async () => {
  const liked = await getLiked();
  if (isSpotifyError(liked)) throw new Error(liked.error);
  return {
    props: {liked},
    revalidate: 86400, // 24 hours
  };
};

export default SpotifyPage;